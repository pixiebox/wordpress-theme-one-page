;(function(p,d){"function"===typeof define&&define.amd?define(d):"object"===typeof exports?module.exports=d:p.dialogBox=d(p)})(this,function(p){"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var d={addEvent:function(a,c,b){c.addEventListener?c.addEventListener(a,b,!1):c.attachEvent?c.attachEvent("on"+a,b):c[a]=b},close:function(a){a.preventDefault?a.preventDefault():a.returnValue=!1;a=a.srcElement||a.target;var c=d.getClosest(a,".dialogBox");
!1!==c&&(d.removeEvent("click",a,d.close),c.parentElement.removeChild(c))},delegateEvent:function(a){var c=a.srcElement||a.target,b=c.getAttribute("data-callback"),e=c.getAttribute("data-rel");"function"==typeof q[e]?(a.preventDefault?a.preventDefault():a.returnValue=!1,q[e](a)):"function"==typeof window[b]&&-1<c.className.indexOf("dialog-answer")&&(c=c.getAttribute("data-result"),window[b](c),d.close(a))},forEach:function(a,c,b){if("[object Object]"===Object.prototype.toString.call(a))for(var e in a)Object.prototype.hasOwnProperty.call(a,
e)&&c.call(b,a[e],e,a);else{e=0;for(var d=a.length;e<d;e++)c.call(b,a[e],e,a)}},getClosest:function(a,c){for(var b=c.charAt(0);a&&a!==document;a=a.parentNode)if("."===b&&-1<a.className.indexOf(c.substr(1))||"#"===b&&a.id===c.substr(1)||"["===b&&a.hasAttribute(c.substr(1,c.length-2))||a.tagName.toLowerCase()===c)return a;return!1},invokeScript:function(a){a=a.getElementsByTagName("SCRIPT");for(var c=a.length,b=0;b<c;b++){var e=a[b].text,d=a[b].src,f=document.createElement("SCRIPT");null!==d&&""!==
d&&(f.src=d);f.text=e;a[b].parentNode.removeChild(a[b]);document.body.appendChild(f)}},pasteHTML:function(a,c){if(4!=a.readyState)return!1;var b=a.status;if(200!=b)return console.log("AJAX: server status "+b),!1;c.querySelector(".dialog-content").insertAdjacentHTML("beforeend",a.responseText);d.invokeScript(c)},promptOnSubmit:function(a,c,b){var e=a.querySelector("form");d.addEvent("submit",e,function(g){g.preventDefault?g.preventDefault():g.returnValue=!1;if(null!==c){var f=new XMLHttpRequest;data=
d.serialize(e,!0);f.open("POST",c,!0);f.setRequestHeader("Content-type","application/x-www-form-urlencoded");f.onreadystatechange=function(){if(4!=f.readyState)return!1;var c=f.status;if(200!=c)return console.log("AJAX: server status "+c),!1;if(null!==b)if("function"==typeof b)b(this.responseText);else if("function"==typeof window[b])window[b](this.responseText);a.parentElement.removeChild(a)};f.send(data)}else if(null!==b){data=d.serialize(e,!1);if("function"==typeof b)b(data);else if("function"==
typeof window[b])window[b](data);a.parentElement.removeChild(a)}else e.submit()})},removeEvent:function(a,c,b){c.removeEventListener?c.removeEventListener(a,b,!1):c.detachEvent?c.detachEvent("on"+a,b):c.splice(a,1)},serialize:function(a,c){if(a&&"form"===a.nodeName.toLowerCase()){var b,e,d=[];for(b=a.elements.length-1;0<=b;--b)if(""!==a.elements[b].name)switch(a.elements[b].nodeName.toLowerCase()){case "button":switch(a.elements[b].type){case "button":case "reset":case "submit":d.push(a.elements[b].name+
"="+encodeURIComponent(a.elements[b].value))}break;case "input":switch(a.elements[b].type){case "button":case "hidden":case "reset":case "password":case "submit":case "text":d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value));break;case "checkbox":case "radio":a.elements[b].checked&&d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value))}break;case "select":switch(a.elements[b].type){case "select-multiple":for(e=a.elements[b].options.length-1;0<=e;--e)a.elements[b].options[e].selected&&
d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].options[e].value));break}case "select-one":d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value));break;case "textarea":d.push(a.elements[b].name+"="+encodeURIComponent(a.elements[b].value))}return c?d.join("&"):d}},setAttributes:function(a,c,b){"string"!==typeof b&&(b="");for(var d in c)a.setAttribute(b+d,c[d])},sticky:function(a){var c=a.querySelector(".dialog-content");a.className+=" stickyBox";c.className+=" clearfix"},
tmplAjaxContainer:function(a){return'<div aria-hidden="true" class="dialogBox" id="dialog-ajax-overlay-'+a+'" role="dialog"><div class="inner-dialog"><div class="dialog-content"><a class="close" href="#">&times;</a><div class="header"></div></div></div></div>'},tmplAlert:function(a){return'<div aria-hidden="true" class="dialogBox" id="alert-overlay-'+a+'" role="dialog"><div class="inner-dialog"><div class="dialog-content"><a class="close" href="#">&times;</a><div class="header"></div><div class="dialog"></div></div></div></div></div>'},
tmplDialog:function(a){return'<div aria-hidden="true" class="dialogBox" id="dialog-overlay-'+a+'" role="dialog"><div class="inner-dialog"><div class="dialog-content"><a class="close" href="#">&times;</a><div class="header"></div><div class="dialog"></div><div class="clearfix options"><button class="btn btn-default" data-callback="dialogCallback" data-answer="cancel">cancel</button><button class="btn btn-primary" data-callback="dialogCallback" data-answer="confirm">confirm</button></div></div></div></div>'},
tmplPrompt:function(a){return'<div aria-hidden="true" class="dialogBox" id="prompt-overlay-'+a+'" role="dialog"><div class="inner-dialog"><div class="dialog-content"><a class="close" href="#">&times;</a><div class="header"></div><div class="dialog"></div><form class="clearfix form-prompt" method="post" action=""><label for="answer">Answer</label><input class="form-control" id="answer" name="answer" type="text" /><button class="btn btn-primary" name="submit" type="submit">Submit</button></form></div></div></div>'}},
q={alert:function(a){var c=a.srcElement||a.target,b=document.querySelectorAll(".dialogBox").length+1,e,g;if(c)a.preventDefault?a.preventDefault():a.returnValue=!1,e=c.getAttribute("data-dialog"),g=null!==c.getAttribute("data-sticky"),c=c.getAttribute("data-title");else{if("selector"in a){a.rel="alert";d.forEach(document.querySelectorAll(a.selector),function(b,c){d.setAttributes(b,a,"data-")});return}e="dialog"in a?a.dialog:null;g="sticky"in a;c="title"in a?a.title:""}document.body.insertAdjacentHTML("beforeend",
d.tmplAlert(b));b=document.querySelector("#alert-overlay-"+b);elTitle=b.querySelector(".header");null!==c?elTitle.innerHTML=c:elTitle.parentElement.removeChild(elTitle);null!==e&&(elDialog=b.querySelector(".dialog"),elDialog.innerHTML=e);d.addEvent("click",b.querySelector(".close"),d.close);g&&d.sticky(b)},dialog:function(a){var c=!1,b=a.srcElement||a.target,e=document.querySelectorAll(".dialogBox").length+1,g,f,h,k,m,l,n;if(b)a.preventDefault?a.preventDefault():a.returnValue=!1,l=b.getAttribute("href"),
null===l||"#"==l?(f=b.getAttribute("data-dialog"),m=JSON.parse(b.getAttribute("data-options")),n=b.getAttribute("data-title"),g=b.getAttribute("data-callback")):(c=!0,l=b.getAttribute("href")),b=null!==b.getAttribute("data-sticky");else{if("selector"in a){a.rel="dialog";d.forEach(document.querySelectorAll(evt.selector),function(b,c){d.setAttributes(b,a,"data-")});return}b="sticky"in a;n="title"in a?a.title:null;"href"in a?(c=!0,l=a.href):(g="callback"in a?a.callback:null,f="dialog"in a?a.dialog:null,
m="options"in a?a.options:null)}if(c)f=new XMLHttpRequest,document.body.insertAdjacentHTML("beforeend",d.tmplAjaxContainer(e)),h=document.querySelector("#dialog-ajax-overlay-"+e),f.open("GET",l,!0),f.onreadystatechange=function(){d.pasteHTML(this,h)},f.send();else if(document.body.insertAdjacentHTML("beforeend",d.tmplDialog(e)),h=document.querySelector("#dialog-overlay-"+e),null!==f&&(e=h.querySelector(".dialog"),e.innerHTML=f),null!==m){for(k=h.querySelector(".options");k.hasChildNodes();)k.removeChild(k.lastChild);
d.forEach(m,function(a,b){k.insertAdjacentHTML("beforeend",'<button class="dialog-answer '+a.className+'" data-callback="'+g+'" data-result="'+b+'">'+b+"</button>")})}b&&d.sticky(h);e=h.querySelector(".header");null!==n?e.innerHTML=n:e.parentElement.removeChild(e);d.addEvent("click",h.querySelector(".close"),d.close)},prompt:function(a){var c=!1,b=null,e=a.srcElement||a.target,g=document.querySelectorAll(".dialogBox").length+1,f,h,k;if(e)a.preventDefault?a.preventDefault():a.returnValue=!1,requestURL=
e.getAttribute("href"),callback=e.getAttribute("data-callback"),postUrl=e.getAttribute("data-postUrl"),h=null!==e.getAttribute("data-sticky"),k=e.getAttribute("data-title"),null!==requestURL&&"#"!=requestURL?(c=!0,requestURL=e.getAttribute("href")):b=e.getAttribute("data-dialog");else if("object"==typeof a){if("selector"in a){a.rel="prompt";d.forEach(document.querySelectorAll(a.selector),function(b,c){d.setAttributes(b,a,"data-")});return}callback="callback"in a?a.callback:null;postUrl="postUrl"in
a?a.postUrl:null;h="sticky"in a;k="title"in a?a.title:null;"href"in a?(c=!0,requestURL=a.requestUrl):b="label"in a?a.label:null}c?(c=new XMLHttpRequest,document.body.insertAdjacentHTML("beforeend",d.tmplAjaxContainer(g)),f=document.querySelector("#dialog-ajax-overlay-"+g),c.open("GET",requestURL,!0),c.onreadystatechange=function(){d.pasteHTML(this,f);d.promptOnSubmit(f,postUrl,callback)},c.send()):(document.body.insertAdjacentHTML("beforeend",d.tmplPrompt(g)),f=document.querySelector("#prompt-overlay-"+
g),null!==b&&(f.querySelector("label").innerText=b),d.promptOnSubmit(f,postUrl,callback));h&&d.sticky(f);elTitle=f.querySelector(".header");null!==k?elTitle.innerHTML=k:elTitle.parentElement.removeChild(elTitle);null!==b&&(elDialog=f.querySelector(".dialog"),elDialog.innerHTML=b);d.addEvent("click",f.querySelector(".close"),d.close)}};d.addEvent("click",document,d.delegateEvent);return q});