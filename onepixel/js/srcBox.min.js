(function(m,b){"function"===typeof define&&define.amd?define(b):"object"===typeof exports?module.exports=b:m.srcBox=b(m)})(this,function(m){Object.size=function(a){var e=0,b;for(b in a)a.hasOwnProperty(b)&&e++;return e};var b={breakpoint:0,breakpointVal:0,currentBreakpoint:0,lazyElems:[],mergedElements:[],selector:{},viewPortWidth:0,addEvent:function(a,e,b){e.addEventListener?e.addEventListener(a,b,!1):e.attachEvent?e.attachEvent("on"+a,b):e[a]=b},debounce:function(a,b,d){var c;return function(){var f=
this,g=arguments,k=d&&!c;clearTimeout(c);c=setTimeout(function(){c=null;d||a.apply(f,g)},b);k&&a.apply(f,g)}},devicePixelRatio:function(){return"devicePixelRatio"in window?window.devicePixelRatio:1},extend:function(a,e){var d={};b.forEach(a,function(b,e){d[e]=a[e]});b.forEach(e,function(a,b){d[b]=e[b]});return d},forEach:function(a,b,d){if("[object Object]"===Object.prototype.toString.call(a))for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&b.call(d,a[c],c,a);else{c=0;for(var f=a.length;c<
f;c++)b.call(d,a[c],c,a)}},getBreakpoint:function(a,e){for(var d=e,c=0,f={},g,k,h,l,n;g=a[c];){l=g.minWidth;k=g.maxWidth;h="minDevicePixelRatio"in g?g.minDevicePixelRatio:0;n="hide"in g;if(0<e){if(l&&k&&e>=l&&e<=k||l&&!k&&e>=l||k&&!l&&e<=k)if(!h||h&&b.devicePixelRatio()>=h)f=g,k&&n&&(f.folder="hide")}else if(0>=d||l<d||k<d)d=l||k||d,f=g;c++}return f},getViewportWidthInCssPixels:function(){for(var a=Math,b=[window.innerWidth,window.document.documentElement.clientWidth,window.document.documentElement.offsetWidth,
window.document.body.clientWidth],d=0,c,f=window.screen.width;d<b.length;d++)isNaN(b[d])&&(b.splice(d,1),d--);b.length&&(c=a.max.apply(a,b),isNaN(f)||(c=a.min(f,c)));return c||f||0},inviewport:function(a){a=a.getBoundingClientRect();var b=document.documentElement;return 0<=a.top&&0<=a.left&&a.bottom<=(window.innerHeight||b.clientHeight)&&a.right<=(window.innerWidth||b.clientWidth)},orientationEvent:function(){return b.supportsOrientationChange()?"orientationchange":"resize"},removeClass:function(a,
b){var d="",c,f=a.className.split(" ");for(c=0;c<f.length;c++)f[c]!==b&&(d+=f[c]+" ");a.className=d},removeEvent:function(a,b,d){b.removeEventListener?b.removeEventListener(a,d,!1):b.detachEvent?b.detachEvent("on"+a,d):b.splice(a,1)},setBreakpoint:function(a,e){if("hide"==e)a.className+=" srcbox-hidden","img"!=a.nodeName.toLowerCase()&&(a.style.backgroundImage="",a.style.backgroundRepeat="");else{0<=a.className.indexOf("srcbox-hidden")&&(a.className=a.className.replace(/(?:^|\s)srcbox-hidden(?!\S)/g,
""));var d=a.getAttribute("data-breakpoint"),c=a.getAttribute("data-img");if(!d||!c)throw Error('srcBox.js [function setBreakpoint]: The provided elements are missing a data-breakpoint or data-img attribute: <img data-breakpoint="/path/to/folder/{breakpoint}" data-img="some-img.jpg" />');d=(d+c).replace("{folder}",e);b.setSrc(a,d)}},setImage:function(a,e){var d=a.getAttribute("data-breakpointwidth"),d=null!==d?d:e.parentOffset?a.parentNode.offsetWidth:b.getViewportWidthInCssPixels(),d=b.getBreakpoint(e.breakpoints,
d).folder;b.setBreakpoint(a,d)},setImages:function(a,e){viewPortWidth=b.getViewportWidthInCssPixels();breakpoint=b.getBreakpoint(h.settings[e].breakpoints,viewPortWidth);breakpointVal=breakpoint.maxWidth||breakpoint.minWidth;b.currentBreakpoint!=breakpointVal&&(e==b.selector[Object.size(b.selector)-1]&&(b.currentBreakpoint=breakpointVal),b.forEach(a,function(d,c){b.setImage(a[c],h.settings[e])}),b.addEvent("scroll",window,b.setLazySrc))},setLazySrc:function(){for(var a=b.lazyElems.length;a--;)b.inviewport(b.lazyElems[a])&&
(b.lazyElems[a].src=b.lazyElems[a].getAttribute("data-lag-src"),b.lazyElems[a].removeAttribute("height"),b.lazyElems.splice(a,1));b.lazyElems.length||b.removeEvent("scroll",window,b.setLazySrc)},setSrc:function(a,e){/(^|\s)lag(\s|$)/.test(a.className)?(a.setAttribute("data-lag-src",e),b.lazyElems.push(a)):"img"===a.nodeName.toLowerCase()?(a.src=e,a.removeAttribute("height")):(a.style.backgroundImage="url("+e+")",a.style.backgroundRepeat="no-repeat")},supportsOrientationChange:function(){return"ontouchstart"in
window}},h={settings:[],init:function(a,e){b.currentBreakpoint=0;if(document.all&&!document.addEventListener){var d=Array.prototype.slice;Array.prototype.slice=function(){if(this instanceof Array)return d.apply(this,arguments);for(var a=[],b=2<=arguments.length?arguments[1]:this.length,c=1<=arguments.length?arguments[0]:0;c<b;c++)a.push(this[c]);return a}}var c=Array.prototype.slice.call(document.querySelectorAll(a)),f={breakpoints:[{folder:"480",maxWidth:480},{folder:"640",minWidth:481,maxWidth:767},
{folder:"900",minWidth:768,maxWidth:900},{folder:"1170",minWidth:992},{folder:"900",minWidth:748,maxWidth:1024},{folder:"640",maxWidth:320,minDevicePixelRatio:2},{folder:"900",minWidth:320,maxWidth:667,minDevicePixelRatio:2},{folder:"2048",minWidth:414,maxWidth:736,minDevicePixelRatio:3},{folder:"2048",minWidth:748,maxWidth:1024,minDevicePixelRatio:2}],parentOffset:!0},f="object"===typeof e&&"breakpoints"in e?"extend"in e&&!0===e.extend?b.extend(f,e):e:b.extend(f,e),g,k=function(){g--;if(!g)h.settings[a].onComplete()};
h.settings[a]=f;b.selector[Object.size(b.selector)]=a;b.mergedElements[a]=c;b.setImages(c,a);b.setLazySrc();b.addEvent("scroll",window,b.setLazySrc);b.addEvent(b.orientationEvent(),window,b.debounce(function(){b.forEach(b.selector,function(a,c){b.setImages(b.mergedElements[b.selector[c]],b.selector[c])})},250));"onComplete"in h.settings[a]&&(g=c.length)&&b.forEach(c,function(e,d){b.setImage(c[d],h.settings[a]);if(/[ws]*(lag)+[ws]*/.test(c[d].className)){if(g--,!g)h.settings[a].onComplete()}else if(c[d].onload=
k,"complete"==c[d].readyState)c[d].onload();else if(c[d].readyState)c[d].src=c[d].src;else if(c[d].complete)c[d].onload();else if(void 0===c[d].complete){var f=c[d].src;c[d].src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";c[d].src=f}})},reset:function(a){b.currentBreakpoint=0;var e=b.mergedElements[a];b.forEach(b.mergedElements[a],function(d,c){b.removeClass(b.mergedElements[a][c],a.substring(1))});h.init(a,h.settings[a]);b.forEach(e,function(b,c){e[c].className+=a.substring(1)})}};
return h});